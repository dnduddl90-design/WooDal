# 🚀 우영달림 가계부 - 개발 일지

**프로젝트명**: 우영♥달림 커플 가계부
**최종 수정**: 2025-11-04
**현재 상태**: Phase 21 완료 (주식 종목 삭제 기능 추가)

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [개발 이력 요약](#개발-이력-요약)
3. [주요 기능](#주요-기능)
4. [기술 스택](#기술-스택)
5. [다음 단계](#다음-단계)

---

## 프로젝트 개요

### 목표
부부/커플을 위한 **실시간 동기화 공유 가계부** 웹앱

### 핵심 기능
- ✅ Google 로그인
- ✅ 실시간 가계부 동기화 (Firebase)
- ✅ 가족 공유 모드 / 개인 모드
- ✅ 달력 기반 거래 관리
- ✅ 통계 및 차트
- ✅ 고정지출 자동 등록
- ✅ 용돈 관리 (추적 + 개인 관리)
- ✅ 모바일 반응형 UI

### 사용자
- **우영** (👨): 관리자
- **달림** (👩): 사용자

---

## 개발 이력 요약

### Phase 1-3: 기반 구축 (2025-10-13 ~ 10-14)
**완료 사항**:
- SOLID 원칙 기반 리팩토링 (2177줄 → 모듈화)
- Firebase Authentication (Google 로그인)
- Firebase Realtime Database 연동
- LocalStorage → Firebase 자동 마이그레이션

**주요 성과**:
- 파일당 평균 100줄 이하로 모듈화
- 실시간 동기화 구현
- 데이터 영구 저장

---

### Phase 4-7: 공유 기능 및 UI (2025-10-15 ~ 10-16)
**완료 사항**:
- 가족 공유 가계부 기능
- 가족 관리 UI (생성, 초대, 탈퇴)
- 이메일 초대 시스템
- 모바일 반응형 구현

**주요 성과**:
- 가족/개인 모드 자동 전환
- 초대 링크 생성 및 처리
- 640px 브레이크포인트 모바일 최적화

---

### Phase 8-12: 추가 기능 (2025-10-16)
**완료 사항**:
- 주식 포트폴리오 기능 (숨김 처리)
- 고정지출 자동 등록
- 테마 시스템 (다크모드 준비)
- 검색 기능

**주요 성과**:
- 고정지출 매달 자동 등록
- 기간별 설정 가능 (시작일~종료일)
- 저축 카테고리 추가

---

### Phase 13: UX 개선 (주말 작업)
**완료 사항**:
- PC/모바일 달력 UX 차별화
  - PC: 날짜 상세 모달만 표시
  - 모바일: 직접 편집 가능
- 주식 메뉴 숨김 (코드 유지)

**주요 성과**:
- 화면 크기별 최적화된 UX
- 이벤트 버블링 제어

---

### Phase 14: 용돈 추적 기능 (2025-10-21)
**완료 사항**:
- 거래 입력 시 `isPocketMoney` 체크박스 추가
- 통계 페이지에 용돈 사용 내역 표시
- 정산 완료 기능 (isPocketMoney → false)
- 사용자별 아바타 및 이름 표시 개선

**주요 성과**:
- 용돈 사용 추적 및 정산 시스템
- 통계에서 사용자별 용돈 사용 현황 확인

---

### Phase 15: 개인 용돈 관리 페이지 (2025-10-21)
**완료 사항**:
1. **기본 페이지 구현**
   - 월별 용돈 잔고 관리
   - 거래 추가/삭제
   - 통계 (일평균, 최대 지출, 거래 건수)

2. **잔고 관리 기능**
   - ➕ 추가: 잔고에 금액 더하기
   - ➖ 차감: 잔고에서 금액 빼기
   - ✏️ 수정: 잔고 직접 설정

3. **이월 기능**
   - 남은 금액 자동 이월
   - 이월 잔고 명확하게 표시
   - 월별 지출만 필터링

**Firebase 구조**:
```
users/{userId}/pocketMoney/
  ├── budget: 500000
  └── transactions/
      └── {transactionId}/
          ├── category: "식비"
          ├── amount: 15000
          ├── date: "2025-10-21"
          └── memo: "점심"
```

**주요 성과**:
- 완전한 잔고 관리 시스템
- 직관적인 3버튼 UI
- 자동 이월로 편리한 관리

---

### Phase 16: 주식 포트폴리오 시각화 (2025-10-21)
**완료 사항**:
1. **DC 계좌 추가**
   - ACCOUNT_TYPES에 DC 추가 (💰 아이콘)
   - 계좌 필터에 DC 버튼 추가

2. **포트폴리오 요약 - 파이 차트 시각화**
   - Recharts 라이브러리 활용
   - 350px 높이, 120px 반지름
   - 12가지 색상 팔레트로 종목 구분
   - 5% 이상 세그먼트만 퍼센트 라벨 표시
   - 커스텀 툴팁 (호버 시 종목명, 평가금액, 비중)
   - **모든 화면 크기에서 표시** (PC/모바일 모두)

3. **보유 종목 목록 (포트폴리오 구성)**
   - 각 종목의 색상 인디케이터 (파이 차트와 일치)
   - 종목명 및 보유 수량
   - 수익/손실 금액 및 퍼센트
   - **포트폴리오 비중** - 전체 자산 대비 퍼센트
   - 색상 프로그레스 바로 비중 시각화
   - 평가금액 표시
   - 호버 시 그림자 효과

4. **색상 시스템**
   - 12색 팔레트: `#6366f1` (보라), `#ec4899` (핑크), `#8b5cf6` (자주) 등
   - 색상 일관성: 차트 → 인디케이터 → 보더 → 프로그레스 바
   - 종목별 고유 색상 자동 할당

**기술 구현**:
- Recharts: ResponsiveContainer, PieChart, Pie, Cell, Tooltip
- 커스텀 툴팁 컴포넌트
- 평가금액 기준 내림차순 정렬
- 동적 색상 스타일 (`style={{ backgroundColor: stock.color }}`)

**파일 수정**:
- `src/constants/stocks.js`: DC 계좌 타입 추가
- `src/components/stock/StockSummary.js`: 210줄 (파이 차트 + 종목 목록)

**주요 성과**:
- 한눈에 보는 포트폴리오 비중 시각화
- 색상으로 구분되는 직관적인 UI
- 모든 디바이스에서 동일한 경험
- 종목별 상세 정보와 차트를 함께 제공

---

### Phase 17: 주식 계좌별 수정 + 용돈 모바일 UX 개선 (2025-10-21)
**완료 사항**:

1. **주식 포트폴리오 - 계좌별 수정 기능**
   - 같은 종목을 여러 계좌에 보유 시 계좌별 개별 수정 가능
   - 계좌별 내역에 호버 시 수정 버튼 표시
   - 전체 수정 vs 계좌별 수정 UI 분리
   - 수정 시 전체 수량 및 평균 매입가 자동 재계산

2. **용돈 관리 - 모바일 UX 개선**
   - 추가/차감/수정 버튼을 잔고 금액 아래로 이동
   - `grid-cols-3`로 버튼 균등 배치
   - 모바일에서 터치하기 쉽게 레이아웃 개선

3. **코드 정리**
   - PocketMoneyPage: 사용하지 않는 `loading` 변수 제거

**기술 구현**:

**StockCard.js**:
- 계좌별 내역에 수정 버튼 추가 (`group/holding` 호버 효과)
- `onEdit(stock, index)` 호출로 holding 인덱스 전달
- 여러 계좌 보유 시 하단 버튼 "전체 수정" 표시

**StockForm.js**:
- `holdingIndex` prop 추가
- 계좌별 수정 시 해당 holding 데이터만 로드
- 계좌별 수정 시 종목 선택 비활성화
- 모달 타이틀 동적 변경: "계좌별 종목 수정"

**StockPage.js**:
- `editingHoldingIndex` 상태 추가
- `handleEdit(stock, holdingIndex)`로 계좌 인덱스 전달
- `handleSubmit`에서 계좌별/전체 수정 분기 처리

**useStocks.js**:
- `handleUpdateStock(id, formData, holdingIndex)` 시그니처 변경
- 계좌별 수정 시:
  - 해당 holding만 업데이트
  - 전체 수량 재계산: `updatedHoldings.reduce((sum, h) => sum + h.quantity, 0)`
  - 평균 매입가 재계산: `totalBuyValue / totalQuantity`
- 전체 수정 시: 기존 로직 유지

**PocketMoneyPage.js**:
- 버튼 레이아웃 변경:
  ```jsx
  // Before: 제목 옆에 가로 배치
  <div className="flex justify-between">
    <h2>💵 용돈 잔고</h2>
    <div className="flex gap-2">...</div>
  </div>

  // After: 잔고 아래 균등 배치
  <h2>💵 용돈 잔고</h2>
  <div className="text-3xl">{금액}</div>
  <div className="grid grid-cols-3 gap-2">
    <Button>추가</Button>
    <Button>차감</Button>
    <Button>수정</Button>
  </div>
  ```

**주요 성과**:
- 주식 계좌별 세밀한 관리 가능
- 수정 시 데이터 일관성 자동 유지 (수량, 매입가)
- 모바일 용돈 관리 UI 개선으로 사용성 향상
- 빌드 크기: 264.73 kB (gzip)

---

## 주요 기능

### 1. 공유 가계부
- 가족 구성원 간 실시간 동기화
- 가족 모드 / 개인 모드 자동 전환
- Firebase 경로: `families/{familyId}/transactions`

### 2. 거래 관리
- 달력 기반 입력/조회
- 카테고리별 분류 (수입/지출)
- 결제 수단 및 메모
- 용돈 사용 여부 체크

### 3. 고정지출
- 매달 자동 등록
- 기간별 설정 (시작일~종료일)
- 활성/비활성 토글

### 4. 용돈 관리
- **추적**: 공유 가계부에서 용돈 사용 표시 + 정산
- **개인 관리**: 별도 페이지에서 잔고 관리
- 추가/차감/수정 기능
- 자동 이월

### 5. 통계 및 분석
- 월별/연도별 통계
- 카테고리별 지출 분석
- 사용자별 통계 (가족 모드)
- 차트 시각화

### 6. 주식 포트폴리오 (관리자 전용)
- 계좌별 종목 관리 (ISA, 연금저축, IRP, DC, 일반)
- 파이 차트로 포트폴리오 비중 시각화
- 종목별 수익률 및 손익 계산
- 현재가 수동 입력 및 일괄 업데이트
- PC/모바일 반응형 (PC: 차트 표시, 모바일: 종목 수만 표시)

### 7. 모바일 최적화
- 반응형 디자인 (640px, 768px 브레이크포인트)
- 하단 네비게이션 바
- 터치 친화적 UI

---

## 기술 스택

### Frontend
- **React** 19.2.0
- **Tailwind CSS** (via CDN)
- **Lucide React** 0.545.0 (아이콘)
- **Recharts** 2.15.0 (차트 라이브러리)

### Backend
- **Firebase Authentication** (Google)
- **Firebase Realtime Database**
- **Firebase Hosting**

### Architecture
- **SOLID 원칙** 기반 모듈화
- Custom Hooks 패턴
- Service Layer 분리

### 디렉토리 구조
```
src/
├── constants/       # 카테고리, 결제수단
├── utils/          # 날짜, 포맷, 저장소
├── services/       # 비즈니스 로직
├── hooks/          # useAuth, useTransactions, usePocketMoney 등
├── firebase/       # Firebase 설정 및 CRUD
├── components/
│   ├── common/     # Button, Input, Modal
│   ├── forms/      # TransactionForm, FixedExpenseForm
│   └── layout/     # Header, Sidebar
└── pages/          # 8개 페이지 (Calendar, Statistics, PocketMoney 등)
```

---

## 배포 이력

| 날짜 | Phase | 빌드 크기 (gzip) | 주요 변경 |
|------|-------|------------------|-----------|
| 10-13 | 1 | - | SOLID 리팩토링 |
| 10-14 | 2-3 | - | Firebase 연동 |
| 10-15 | 4-7 | - | 가족 공유 + 모바일 |
| 10-16 | 8-12 | - | 고정지출 등 |
| 주말 | 13 | 169.91 kB | 달력 UX 개선 |
| 10-21 | 14 | 172.69 kB | 용돈 추적 |
| 10-21 | 15-1 | 174.66 kB | 용돈 페이지 |
| 10-21 | 15-2 | 174.83 kB | 이월 기능 |
| 10-21 | 15-3 | **175.25 kB** | 잔고 관리 완성 |

**현재 URL**: https://woodal-budget.web.app

---

## 다음 단계

### 우선순위 High
- [ ] Firebase Security Rules 강화
- [ ] PWA 전환 (오프라인 지원)
- [ ] 예산 관리 및 알림

### 우선순위 Medium
- [ ] 데이터 백업/복원 UI
- [ ] 월별 리포트 PDF 생성
- [ ] 카테고리 커스터마이징

### 우선순위 Low
- [ ] TypeScript 마이그레이션
- [ ] 단위 테스트 작성
- [ ] 다크모드 완성

---

## 📚 관련 문서

- [상세 개발일지](./개발일지.md) - 전체 개발 과정 상세 기록
- [Firebase 데이터 관리 가이드](./Firebase-데이터-관리-가이드.md)
- [SOLID 가이드](./SOLID.md)
- [README](./README.md)

---

**작성자**: Claude Code
**프로젝트 시작**: 2025-10-13
**총 개발 기간**: 9일
**총 Phase**: 16개 완료


### Phase 18: 주식 현재가 입력 UX 개선 (2025-10-21)

**배경**:
- 초기 구현: 실시간 시세 자동 조회 기능 시도
- 문제: CORS 정책으로 브라우저에서 직접 API 호출 불가
- 해결: 네이버 금융 링크 버튼으로 변경 (실용적 접근)

**완료 사항**:

1. **현재가 입력 모달 (PriceUpdateModal) 개선**
   - 🔗 네이버 금융 링크 버튼 추가 (각 종목마다)
   - 버튼 클릭 시 새 탭에서 네이버 금융 열림
   - 안내 메시지 추가: "각 종목 옆 🔗 버튼을 클릭하면..."

2. **주식 추가/수정 폼 (StockForm) 개선**
   - 현재가 입력 필드 옆에 "시세확인" 버튼 추가
   - ExternalLink 아이콘 사용
   - 종목 선택 시에만 버튼 표시

3. **불필요한 코드 제거**
   - 자동 조회 함수 제거
   - CORS 프록시 서비스 호출 코드 제거
   - RefreshCw 아이콘 import 제거

**주요 성과**:
- ✅ 실용적인 UX: 자동 조회 실패 대신 직접 확인 방식
- ✅ 코드 단순화: CORS 우회 로직 제거
- ✅ 사용자 편의성: 네이버 금융 새 탭으로 빠른 확인
- ✅ 안정성: 외부 API 의존도 제거

**빌드 크기**:
- 265.24 kB (gzip, +508 B)

**배포**:
- Firebase Hosting 배포 완료
- URL: https://woodal-budget.web.app

---

### Phase 19: 모바일 날짜 네비게이션 UX 개선 (2025-11-04)

**배경**:
- 기존: 모바일에서 월의 첫날/마지막 날에서 < > 버튼 비활성화
- 문제: 11/1일에서 10/31일로 이동하려면 월 전환 버튼 클릭 필요 (UX 불편)
- 개선: 날짜 네비게이션이 월 경계를 자연스럽게 넘어가도록

**완료 사항**:

1. **날짜 네비게이션 로직 개선 (CalendarPage.js:271-297)**
   - `handlePrevDay`: 1일에서 < 버튼 클릭 → 이전 달 마지막 날로 이동
     * 예: 11월 1일 → 10월 31일
     * 월 자동 변경 + 이전 달 마지막 날 계산
   - `handleNextDay`: 마지막 날에서 > 버튼 클릭 → 다음 달 첫날로 이동
     * 예: 10월 31일 → 11월 1일
     * 월 자동 변경 + 다음 달 1일로 설정

2. **버튼 활성화 상태 변경**
   - 기존: `disabled={currentDay === 1}` / `disabled={currentDay === daysInMonth}`
   - 변경: 두 버튼 모두 항상 활성화
   - 스타일: 비활성화 스타일 제거 (회색 처리 제거)

3. **사용하지 않는 변수 제거**
   - `renderMobileDayView`에서 `daysInMonth` 변수 제거
   - ESLint 경고 해결

**주요 성과**:
- ✅ 자연스러운 날짜 흐름: 월 경계 없이 연속된 날짜 이동
- ✅ UX 개선: 추가 클릭 없이 이전/다음 날로 바로 이동
- ✅ 직관적: 캘린더처럼 날짜가 끊김 없이 이어짐
- ✅ 코드 정리: 불필요한 변수 제거

**빌드 크기**:
- 265.27 kB (gzip, -3 B)

**배포**:
- Firebase Hosting 배포 완료
- URL: https://woodal-budget.web.app

---

### Phase 21: 주식 종목 삭제 기능 추가 (2025-12-09)

**배경**:
- 기존: 설정 페이지에서 주식 종목 추가/수정만 가능
- 요구사항: 불필요한 종목을 삭제할 수 있는 기능 추가
- 목표: 종목별 삭제 버튼 및 삭제 확인 UI 구현

**완료 사항**:

1. **Firebase 삭제 함수 추가 (databaseService.js:814-820)**
   ```javascript
   export const deleteStockSymbol = async (userId, symbolId) => {
     const symbolRef = ref(database, getUserPath(userId, `stockSymbols/${symbolId}`));
     await remove(symbolRef);
   };
   ```
   - 사용자별 주식 종목 삭제 지원
   - Firebase Realtime Database에서 실시간 삭제

2. **주식 종목 관리 훅 추가 (useStockSymbols.js)**
   - 새로운 커스텀 훅 생성 (SRP 원칙)
   - 종목 CRUD 로직 완전 분리
   - 주요 기능:
     * `handleAddSymbol`: 종목 추가
     * `handleUpdateSymbol`: 종목 수정
     * `handleDeleteSymbol`: 종목 삭제
     * 실시간 리스너로 종목 목록 자동 업데이트
     * 기본 종목 자동 마이그레이션

3. **종목 관리 컴포넌트 생성 (StockSymbolManager.js)**
   - 독립적인 설정 컴포넌트 (SRP)
   - 주요 UI:
     * 종목 목록 (이름, 코드 표시)
     * 종목별 수정 버튼 (연필 아이콘)
     * 종목별 삭제 버튼 (휴지통 아이콘)
     * 호버 시 버튼 강조 효과
   - 삭제 확인 다이얼로그
   - 관리자 권한 체크 (admin만 삭제 가능)

4. **설정 페이지 통합 (SettingsPage.js:93-100)**
   - StockSymbolManager 컴포넌트 추가
   - Props 전달:
     * stockSymbols: 종목 목록
     * onAddSymbol: 추가 핸들러
     * onUpdateSymbol: 수정 핸들러
     * onDeleteSymbol: 삭제 핸들러
     * currentUser: 권한 체크용

5. **App.js 통합 (App.js:107-113, 614-617)**
   - useStockSymbols 훅 사용
   - SettingsPage에 모든 핸들러 전달
   - 실시간 동기화 지원

**주요 성과**:
- ✅ SOLID 원칙 준수: useStockSymbols 훅으로 로직 분리
- ✅ 재사용 가능: StockSymbolManager 독립 컴포넌트
- ✅ 사용자 친화적: 삭제 확인 다이얼로그로 실수 방지
- ✅ 권한 관리: 관리자만 종목 삭제 가능
- ✅ 실시간 동기화: Firebase Realtime Database 활용

**빌드 크기**:
- 266.59 kB (gzip, +233 B)

**배포**:
- Firebase Hosting 배포 예정

---


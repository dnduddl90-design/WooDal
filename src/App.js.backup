import React, { useState } from 'react';
import { Plus, Search, Settings, TrendingUp, DollarSign, Home, Car, ShoppingCart, Heart, Smartphone, Coffee, MoreHorizontal, X, Edit2, Trash2, ChevronLeft, ChevronRight, PiggyBank, Receipt, AlertCircle, Eye, EyeOff, LogOut } from 'lucide-react';

const CATEGORIES = {
  expense: [
    { id: 'food', name: 'ì‹ë¹„', icon: Coffee, color: 'bg-orange-100 text-orange-600 border-orange-200', subCategories: ['ì™¸ì‹', 'ì¥ë³´ê¸°', 'ë°°ë‹¬'] },
    { id: 'transport', name: 'êµí†µë¹„', icon: Car, color: 'bg-blue-100 text-blue-600 border-blue-200', subCategories: ['ëŒ€ì¤‘êµí†µ', 'ì£¼ìœ ', 'íƒì‹œ'] },
    { id: 'living', name: 'ìƒí™œìš©í’ˆ', icon: Home, color: 'bg-green-100 text-green-600 border-green-200', subCategories: ['ë§ˆíŠ¸', 'ì•½êµ­', 'ì²­ì†Œìš©í’ˆ'] },
    { id: 'medical', name: 'ì˜ë£Œë¹„', icon: Heart, color: 'bg-red-100 text-red-600 border-red-200', subCategories: ['ë³‘ì›', 'ì•½ê°’', 'ê±´ê°•ê²€ì§„'] },
    { id: 'culture', name: 'ë¬¸í™”ìƒí™œ', icon: Coffee, color: 'bg-purple-100 text-purple-600 border-purple-200', subCategories: ['ì˜í™”', 'ì±…', 'ì·¨ë¯¸'] },
    { id: 'fashion', name: 'ì˜ë¥˜ë¯¸ìš©', icon: ShoppingCart, color: 'bg-pink-100 text-pink-600 border-pink-200', subCategories: ['ì˜·', 'í™”ì¥í’ˆ', 'ë¯¸ìš©ì‹¤'] },
    { id: 'communication', name: 'í†µì‹ ë¹„', icon: Smartphone, color: 'bg-indigo-100 text-indigo-600 border-indigo-200', subCategories: ['íœ´ëŒ€í°', 'ì¸í„°ë„·'] },
    { id: 'gift', name: 'ìš©ëˆì„ ë¬¼', icon: Heart, color: 'bg-rose-100 text-rose-600 border-rose-200', subCategories: [] },
    { id: 'other', name: 'ê¸°íƒ€', icon: MoreHorizontal, color: 'bg-gray-100 text-gray-600 border-gray-200', subCategories: [] }
  ],
  income: [
    { id: 'salary', name: 'ê¸‰ì—¬', icon: DollarSign, color: 'bg-emerald-100 text-emerald-600 border-emerald-200', subCategories: ['ìš°ì˜', 'ë‹¬ë¦¼'] },
    { id: 'side', name: 'ë¶€ìˆ˜ì…', icon: TrendingUp, color: 'bg-cyan-100 text-cyan-600 border-cyan-200', subCategories: ['íˆ¬ì', 'ë¶€ì—…'] },
    { id: 'other', name: 'ê¸°íƒ€', icon: MoreHorizontal, color: 'bg-gray-100 text-gray-600 border-gray-200', subCategories: [] }
  ]
};

const PAYMENT_METHODS = [
  { id: 'cash', name: 'í˜„ê¸ˆ' },
  { id: 'credit', name: 'ì‹ ìš©ì¹´ë“œ' },
  { id: 'debit', name: 'ì²´í¬ì¹´ë“œ' },
  { id: 'transfer', name: 'ê³„ì¢Œì´ì²´' },
  { id: 'other', name: 'ê¸°íƒ€' }
];

const MOCK_USERS = {
  user1: { id: 'user1', name: 'ìš°ì˜', avatar: 'ğŸ‘¨', role: 'admin', color: 'bg-blue-500' },
  user2: { id: 'user2', name: 'ë‹¬ë¦¼', avatar: 'ğŸ‘©', role: 'user', color: 'bg-pink-500' }
};

const formatCurrency = (amount) => {
  return new Intl.NumberFormat('ko-KR').format(amount);
};

const getDaysInMonth = (date) => {
  return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
};

const getFirstDayOfMonth = (date) => {
  return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
};

export default function CoupledBudgetApp() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [loginPassword, setLoginPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [currentView, setCurrentView] = useState('calendar');
  const [currentDate, setCurrentDate] = useState(new Date());
  const [showAddTransaction, setShowAddTransaction] = useState(false);
  const [currentUser] = useState(MOCK_USERS.user1);

  // ê±°ë˜ ë‚´ì—­ ìƒíƒœ
  const [transactions, setTransactions] = useState([
    {
      id: 1,
      date: '2024-09-16',
      type: 'expense',
      category: 'food',
      subcategory: 'ì™¸ì‹',
      amount: 25000,
      paymentMethod: 'credit',
      memo: 'ì ì‹¬ ì‹ì‚¬',
      userId: 'user1'
    },
    {
      id: 2,
      date: '2024-09-16',
      type: 'income',
      category: 'salary',
      subcategory: 'ìš°ì˜',
      amount: 3500000,
      memo: '9ì›” ê¸‰ì—¬',
      userId: 'user1'
    },
    {
      id: 3,
      date: '2024-09-20',
      type: 'expense',
      category: 'transport',
      subcategory: 'ëŒ€ì¤‘êµí†µ',
      amount: 5000,
      paymentMethod: 'debit',
      memo: 'ì§€í•˜ì² ',
      userId: 'user2'
    }
  ]);

  // ê³ ì •ì§€ì¶œ ìƒíƒœ
  const [fixedExpenses, setFixedExpenses] = useState([
    {
      id: 1,
      name: 'ì›”ì„¸',
      category: 'living',
      amount: 800000,
      autoRegisterDate: 1,
      monthlyIncrease: 0,
      paymentMethod: 'transfer',
      memo: 'ì›”ì„¸',
      isActive: true
    }
  ]);

  // í¼ ìƒíƒœë“¤
  const [editingTransaction, setEditingTransaction] = useState(null);
  const [isEditMode, setIsEditMode] = useState(false);
  
  const [transactionForm, setTransactionForm] = useState({
    type: 'expense',
    category: '',
    subcategory: '',
    amount: '',
    paymentMethod: '',
    memo: '',
    date: new Date().toISOString().split('T')[0]
  });

  // ê³ ì •ì§€ì¶œ ìƒíƒœ ì¶”ê°€
  // eslint-disable-next-line no-unused-vars
  const [showAddFixed, setShowAddFixed] = useState(false);
  const [editingFixed, setEditingFixed] = useState(null);
  const [fixedForm, setFixedForm] = useState({
    name: '',
    category: '',
    amount: '',
    autoRegisterDate: 1,
    monthlyIncrease: '',
    paymentMethod: '',
    memo: '',
    isActive: true
  });

  // ê²€ìƒ‰ ìƒíƒœ ì¶”ê°€
  const [searchQuery, setSearchQuery] = useState('');
  const [searchFilters, setSearchFilters] = useState({
    type: 'all', // all, income, expense
    category: 'all',
    dateFrom: '',
    dateTo: '',
    amountMin: '',
    amountMax: '',
    user: 'all'
  });
  const [searchResults, setSearchResults] = useState([]);

  // ì„¤ì • ìƒíƒœ ì¶”ê°€
  const [settings, setSettings] = useState({
    theme: 'default', // default, dark, colorful
    currency: 'KRW', // KRW, USD, EUR
    dateFormat: 'ko-KR', // ko-KR, en-US
    budget: {
      monthly: '',
      categories: {
        food: '',
        transport: '',
        living: '',
        medical: '',
        culture: '',
        fashion: '',
        communication: ''
      }
    },
    notifications: {
      budgetAlert: true,
      dailyReminder: false,
      weeklyReport: true
    },
    backup: {
      autoBackup: true,
      backupFrequency: 'weekly' // daily, weekly, monthly
    }
  });
  const [showBackupModal, setShowBackupModal] = useState(false);
  const [backupData, setBackupData] = useState('');

  // ë¡œê·¸ì¸ ê´€ë ¨ í•¨ìˆ˜
  const handleLogin = () => {
    if (loginPassword === '1234') {
      setIsAuthenticated(true);
      setLoginError('');
      setLoginPassword('');
    } else {
      setLoginError('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. (ê¸°ë³¸ ë¹„ë°€ë²ˆí˜¸: 1234)');
    }
  };

  // ê²€ìƒ‰ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì¶”ê°€
  const performSearch = () => {
    let results = [...transactions];

    // í…ìŠ¤íŠ¸ ê²€ìƒ‰ (ë©”ëª¨, ì¹´í…Œê³ ë¦¬ ì´ë¦„)
    if (searchQuery.trim()) {
      const query = searchQuery.toLowerCase().trim();
      results = results.filter(transaction => {
        const category = CATEGORIES[transaction.type]?.find(c => c.id === transaction.category);
        const categoryName = category ? category.name.toLowerCase() : '';
        const subcategory = (transaction.subcategory || '').toLowerCase();
        const memo = (transaction.memo || '').toLowerCase();
        
        return categoryName.includes(query) || 
               subcategory.includes(query) || 
               memo.includes(query);
      });
    }

    // íƒ€ì… í•„í„°
    if (searchFilters.type !== 'all') {
      results = results.filter(t => t.type === searchFilters.type);
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„°
    if (searchFilters.category !== 'all') {
      results = results.filter(t => t.category === searchFilters.category);
    }

    // ë‚ ì§œ ë²”ìœ„ í•„í„°
    if (searchFilters.dateFrom) {
      results = results.filter(t => t.date >= searchFilters.dateFrom);
    }
    if (searchFilters.dateTo) {
      results = results.filter(t => t.date <= searchFilters.dateTo);
    }

    // ê¸ˆì•¡ ë²”ìœ„ í•„í„°
    if (searchFilters.amountMin) {
      const minAmount = parseInt(searchFilters.amountMin);
      results = results.filter(t => t.amount >= minAmount);
    }
    if (searchFilters.amountMax) {
      const maxAmount = parseInt(searchFilters.amountMax);
      results = results.filter(t => t.amount <= maxAmount);
    }

    // ì‚¬ìš©ì í•„í„°
    if (searchFilters.user !== 'all') {
      results = results.filter(t => t.userId === searchFilters.user);
    }

    // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
    results.sort((a, b) => new Date(b.date) - new Date(a.date));

    setSearchResults(results);
  };

  const resetSearch = () => {
    setSearchQuery('');
    setSearchFilters({
      type: 'all',
      category: 'all',
      dateFrom: '',
      dateTo: '',
      amountMin: '',
      amountMax: '',
      user: 'all'
    });
    setSearchResults([]);
  };

  const getAllCategories = () => {
    return [
      ...CATEGORIES.income.map(c => ({...c, type: 'income'})),
      ...CATEGORIES.expense.map(c => ({...c, type: 'expense'}))
    ];
  };

  // ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ë“¤ ì¶”ê°€
  const updateSettings = (newSettings) => {
    setSettings(prev => ({...prev, ...newSettings}));
    // ì‹¤ì œ ì•±ì—ì„œëŠ” localStorageë‚˜ ì„œë²„ì— ì €ì¥
  };

  const exportData = () => {
    const exportObj = {
      transactions,
      fixedExpenses,
      settings,
      exportDate: new Date().toISOString(),
      version: '1.0'
    };
    const dataStr = JSON.stringify(exportObj, null, 2);
    setBackupData(dataStr);
    setShowBackupModal(true);
  };

  const importData = (jsonStr) => {
    try {
      const importObj = JSON.parse(jsonStr);
      if (importObj.transactions) {
        setTransactions(importObj.transactions);
      }
      if (importObj.fixedExpenses) {
        setFixedExpenses(importObj.fixedExpenses);
      }
      if (importObj.settings) {
        setSettings(importObj.settings);
      }
      alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
    } catch (error) {
      alert('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹ì…ë‹ˆë‹¤.');
    }
  };

  const resetAllData = () => {
    if (window.confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
      setTransactions([]);
      setFixedExpenses([]);
      setSettings({
        theme: 'default',
        currency: 'KRW',
        dateFormat: 'ko-KR',
        budget: {
          monthly: '',
          categories: {
            food: '', transport: '', living: '', medical: '',
            culture: '', fashion: '', communication: ''
          }
        },
        notifications: {
          budgetAlert: true,
          dailyReminder: false,
          weeklyReport: true
        },
        backup: {
          autoBackup: true,
          backupFrequency: 'weekly'
        }
      });
      alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  };

  const downloadBackup = () => {
    const blob = new Blob([backupData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `ê°€ê³„ë¶€_ë°±ì—…_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };

  // ê³ ì •ì§€ì¶œ ê´€ë ¨ í•¨ìˆ˜ë“¤ ì¶”ê°€
  const resetFixedForm = () => {
    setFixedForm({
      name: '',
      category: '',
      amount: '',
      autoRegisterDate: 1,
      monthlyIncrease: '',
      paymentMethod: '',
      memo: '',
      isActive: true
    });
    setEditingFixed(null);
  };

  const handleAddFixedExpense = (formData) => {
    const newFixed = {
      id: Date.now(),
      ...formData,
      amount: parseInt(formData.amount) || 0,
      autoRegisterDate: parseInt(formData.autoRegisterDate) || 1,
      monthlyIncrease: parseInt(formData.monthlyIncrease) || 0
    };
    setFixedExpenses(prev => [...prev, newFixed]);
  };

  const handleUpdateFixedExpense = (id, formData) => {
    setFixedExpenses(prev => 
      prev.map(fixed => 
        fixed.id === id 
          ? { 
              ...fixed, 
              ...formData, 
              amount: parseInt(formData.amount) || 0,
              autoRegisterDate: parseInt(formData.autoRegisterDate) || 1,
              monthlyIncrease: parseInt(formData.monthlyIncrease) || 0 
            }
          : fixed
      )
    );
  };

  const handleDeleteFixedExpense = (id) => {
    setFixedExpenses(prev => prev.filter(fixed => fixed.id !== id));
  };

  const handleToggleActive = (id) => {
    setFixedExpenses(prev => 
      prev.map(fixed => 
        fixed.id === id ? { ...fixed, isActive: !fixed.isActive } : fixed
      )
    );
  };

  const startEditFixed = (fixed) => {
    setEditingFixed(fixed);
    setFixedForm({
      name: fixed.name,
      category: fixed.category,
      amount: fixed.amount.toString(),
      autoRegisterDate: fixed.autoRegisterDate,
      monthlyIncrease: fixed.monthlyIncrease.toString(),
      paymentMethod: fixed.paymentMethod || '',
      memo: fixed.memo || '',
      isActive: fixed.isActive
    });
    setShowAddFixed(true);
  };

  // eslint-disable-next-line no-unused-vars
  const handleSubmitFixed = () => {
    if (fixedForm.name && fixedForm.category && fixedForm.amount) {
      if (editingFixed) {
        handleUpdateFixedExpense(editingFixed.id, fixedForm);
      } else {
        handleAddFixedExpense(fixedForm);
      }
      resetFixedForm();
      setShowAddFixed(false);
    }
  };

  const handleLogout = () => {
    setIsAuthenticated(false);
    setCurrentView('calendar');
    setLoginPassword('');
    setLoginError('');
  };

  // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
  const getDayTransactions = (day, month, year) => {
    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    return transactions.filter(t => t.date === dateStr);
  };

  const getFixedExpensesForDay = (day) => {
    return fixedExpenses.filter(expense => 
      expense.isActive && expense.autoRegisterDate === day
    );
  };

  // ê±°ë˜ ê´€ë ¨ í•¨ìˆ˜ë“¤
  const handleAddTransaction = (formData) => {
    const newTransaction = {
      id: Date.now(),
      ...formData,
      amount: parseInt(formData.amount) || 0,
      userId: currentUser.id
    };
    setTransactions(prev => [...prev, newTransaction]);
  };

  const handleUpdateTransaction = (id, formData) => {
    setTransactions(prev => 
      prev.map(t => 
        t.id === id 
          ? { ...t, ...formData, amount: parseInt(formData.amount) || 0 }
          : t
      )
    );
  };

  const handleDeleteTransaction = (id) => {
    setTransactions(prev => prev.filter(t => t.id !== id));
  };

  const startEditTransaction = (transaction) => {
    setIsEditMode(true);
    setEditingTransaction(transaction);
    setTransactionForm({
      type: transaction.type,
      category: transaction.category,
      subcategory: transaction.subcategory || '',
      amount: transaction.amount.toString(),
      paymentMethod: transaction.paymentMethod || '',
      memo: transaction.memo || '',
      date: transaction.date
    });
    setShowAddTransaction(true);
  };

  const startAddTransaction = () => {
    setIsEditMode(false);
    setEditingTransaction(null);
    setTransactionForm({
      type: 'expense',
      category: '',
      subcategory: '',
      amount: '',
      paymentMethod: '',
      memo: '',
      date: new Date().toISOString().split('T')[0]
    });
    setShowAddTransaction(true);
  };

  const resetForm = () => {
    setTransactionForm({
      type: 'expense',
      category: '',
      subcategory: '',
      amount: '',
      paymentMethod: '',
      memo: '',
      date: new Date().toISOString().split('T')[0]
    });
    setIsEditMode(false);
    setEditingTransaction(null);
  };

  const handleSubmitTransaction = () => {
    if (transactionForm.category && transactionForm.amount) {
      if (isEditMode && editingTransaction) {
        handleUpdateTransaction(editingTransaction.id, transactionForm);
      } else {
        handleAddTransaction(transactionForm);
      }
      resetForm();
      setShowAddTransaction(false);
    }
  };

  if (!isAuthenticated) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-pink-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
          <div className="text-center mb-8">
            <div className="flex items-center justify-center space-x-2 mb-4">
              <span className="text-3xl">ğŸ‘¨</span>
              <Heart className="text-red-500" size={24} />
              <span className="text-3xl">ğŸ‘©</span>
            </div>
            <h1 className="text-2xl font-bold text-gray-800 mb-2">ìš°ì˜ â™¥ ë‹¬ë¦¼</h1>
            <p className="text-gray-600">ë¶€ë¶€ ê°€ê³„ë¶€</p>
          </div>

          <div className="space-y-6">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
              <div className="relative">
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={loginPassword}
                  onChange={(e) => setLoginPassword(e.target.value)}
                  onKeyDown={(e) => {
                    if (e.key === 'Enter') {
                      handleLogin();
                    }
                  }}
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-3 text-gray-400 hover:text-gray-600"
                >
                  {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                </button>
              </div>
              {loginError && (
                <p className="mt-2 text-sm text-red-600">{loginError}</p>
              )}
            </div>

            <button
              type="button"
              onClick={handleLogin}
              className="w-full bg-gradient-to-r from-blue-500 to-pink-500 text-white py-3 rounded-lg font-medium hover:from-blue-600 hover:to-pink-600 transition-all duration-200 transform hover:scale-105"
            >
              ë¡œê·¸ì¸
            </button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
      <header className="bg-white border-b border-gray-200 px-6 py-4 shadow-sm">
        <div className="flex justify-between items-center">
          <div className="flex items-center space-x-3">
            <div className="flex items-center space-x-2">
              <span className="text-2xl">ğŸ‘¨</span>
              <Heart className="text-red-500" size={20} />
              <span className="text-2xl">ğŸ‘©</span>
            </div>
            <h1 className="text-xl font-bold text-gray-900">ìš°ì˜ â™¥ ë‹¬ë¦¼ ê°€ê³„ë¶€</h1>
          </div>
          
          <div className="flex items-center space-x-4">
            <div className="flex items-center space-x-2">
              <div className={`w-10 h-10 rounded-full ${currentUser.color} flex items-center justify-center text-white text-sm font-medium`}>
                {currentUser.avatar}
              </div>
              <span className="text-sm font-medium text-gray-700">{currentUser.name}</span>
            </div>
            <button
              onClick={handleLogout}
              className="flex items-center space-x-2 px-3 py-2 text-red-600 bg-red-50 rounded-lg hover:bg-red-100 transition-colors"
            >
              <LogOut size={16} />
              <span className="text-sm">ë¡œê·¸ì•„ì›ƒ</span>
            </button>
          </div>
        </div>
      </header>

      <div className="flex">
        <nav className="w-64 bg-white border-r border-gray-200 min-h-screen shadow-sm">
          <div className="p-4 space-y-2">
            {[
              { id: 'calendar', name: 'ê°€ê³„ë¶€', icon: PiggyBank },
              { id: 'statistics', name: 'í†µê³„', icon: TrendingUp },
              { id: 'fixed', name: 'ê³ ì •ì§€ì¶œ', icon: Receipt },
              { id: 'search', name: 'ê²€ìƒ‰', icon: Search },
              { id: 'settings', name: 'ì„¤ì •', icon: Settings }
            ].map(item => {
              const IconComponent = item.icon;
              return (
                <button
                  key={item.id}
                  onClick={() => setCurrentView(item.id)}
                  className={`w-full flex items-center space-x-3 px-4 py-3 rounded-xl text-left font-medium transition-all duration-200 ${
                    currentView === item.id 
                      ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg transform scale-105' 
                      : 'text-gray-700 hover:bg-gray-50 hover:scale-102'
                  }`}
                >
                  <IconComponent size={20} />
                  <span>{item.name}</span>
                </button>
              );
            })}
          </div>
        </nav>

        <main className="flex-1 p-8">
          {currentView === 'calendar' && (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-gray-800">
                  {currentDate.getFullYear()}ë…„ {currentDate.getMonth() + 1}ì›”
                </h2>
                <div className="flex space-x-3">
                  <button
                    onClick={() => {
                      const newDate = new Date(currentDate);
                      newDate.setMonth(newDate.getMonth() - 1);
                      setCurrentDate(newDate);
                    }}
                    className="p-3 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <ChevronLeft size={20} />
                  </button>
                  <button
                    onClick={() => setCurrentDate(new Date())}
                    className="px-4 py-2 bg-blue-500 text-white rounded-xl text-sm font-medium hover:bg-blue-600 transition-colors"
                  >
                    ì˜¤ëŠ˜
                  </button>
                  <button
                    onClick={() => {
                      const newDate = new Date(currentDate);
                      newDate.setMonth(newDate.getMonth() + 1);
                      setCurrentDate(newDate);
                    }}
                    className="p-3 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <ChevronRight size={20} />
                  </button>
                </div>
              </div>

              <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div className="grid grid-cols-7 gap-0">
                  {['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '].map(day => (
                    <div key={day} className="p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-center font-semibold">
                      {day}
                    </div>
                  ))}
                  
                  {(() => {
                    const daysInMonth = getDaysInMonth(currentDate);
                    const firstDay = getFirstDayOfMonth(currentDate);
                    const days = [];

                    // ì´ì „ ë‹¬ ë¹ˆ ì¹¸
                    for (let i = 0; i < firstDay; i++) {
                      days.push(
                        <div key={`prev-${i}`} className="h-24 border border-gray-100 p-1 bg-gray-50">
                          <div className="text-sm text-gray-400 mb-1"></div>
                        </div>
                      );
                    }

                    // í˜„ì¬ ë‹¬ ë‚ ì§œë“¤
                    for (let day = 1; day <= daysInMonth; day++) {
                      const dayTransactions = getDayTransactions(day, currentDate.getMonth(), currentDate.getFullYear());
                      const fixedExpensesForDay = getFixedExpensesForDay(day);
                      const isToday = 
                        day === new Date().getDate() &&
                        currentDate.getMonth() === new Date().getMonth() &&
                        currentDate.getFullYear() === new Date().getFullYear();

                      const allItems = [
                        ...dayTransactions,
                        ...fixedExpensesForDay.map(f => ({...f, type: 'fixed'}))
                      ];

                      days.push(
                        <div 
                          key={day} 
                          className={`h-24 border border-gray-200 p-1 hover:bg-gray-50 transition-colors ${
                            isToday ? 'ring-2 ring-blue-500' : ''
                          }`}
                        >
                          <div className="text-sm font-medium mb-1">{day}</div>
                          {allItems.length > 0 ? (
                            <div className="space-y-1">
                              {allItems.slice(0, 2).map((item, index) => {
                                const user = item.type === 'fixed' ? null : MOCK_USERS[item.userId];
                                
                                return (
                                  <div key={index} className="text-xs flex items-center justify-between group hover:bg-white hover:bg-opacity-50 rounded px-1 py-0.5 transition-colors">
                                    <div 
                                      className="flex items-center space-x-1 flex-1 cursor-pointer"
                                      onClick={() => {
                                        if (item.type !== 'fixed') {
                                          startEditTransaction(item);
                                        }
                                      }}
                                    >
                                      <div className={`w-2 h-2 rounded-full ${
                                        item.type === 'fixed' ? 'bg-orange-500' :
                                        user ? user.color : 'bg-gray-500'
                                      }`}></div>
                                      <span className={
                                        item.type === 'expense' || item.type === 'fixed' ? 'text-red-600' : 'text-blue-600'
                                      }>
                                        {item.type === 'expense' || item.type === 'fixed' ? '-' : '+'}
                                        {formatCurrency(item.amount)}
                                      </span>
                                    </div>
                                    {item.type !== 'fixed' && (
                                      <button
                                        type="button"
                                        onClick={(e) => {
                                          e.stopPropagation();
                                          handleDeleteTransaction(item.id);
                                        }}
                                        className="opacity-0 group-hover:opacity-100 p-0.5 text-red-500 hover:text-red-700 transition-all"
                                        title="ì‚­ì œ"
                                      >
                                        <X size={12} />
                                      </button>
                                    )}
                                  </div>
                                );
                              })}
                              {allItems.length > 2 && (
                                <div className="text-xs text-gray-500">
                                  +{allItems.length - 2}ê°œ ë”
                                </div>
                              )}
                            </div>
                          ) : (
                            <div className="flex items-center justify-center h-12">
                              <div className="text-2xl opacity-30">ğŸ˜´</div>
                            </div>
                          )}
                        </div>
                      );
                    }

                    // ë‹¤ìŒ ë‹¬ ë¹ˆ ì¹¸
                    const totalCells = 42;
                    const usedCells = firstDay + daysInMonth;
                    for (let i = 1; i <= totalCells - usedCells; i++) {
                      days.push(
                        <div key={`next-${i}`} className="h-24 border border-gray-100 p-1 bg-blue-50">
                          <div className="text-sm text-blue-400 mb-1">{i}</div>
                        </div>
                      );
                    }

                    return days;
                  })()}
                </div>
              </div>
            </div>
          )}

          {currentView === 'statistics' && (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-gray-800">
                  {currentDate.getFullYear()}ë…„ {currentDate.getMonth() + 1}ì›” í†µê³„
                </h2>
                <div className="flex space-x-3">
                  <button
                    onClick={() => {
                      const newDate = new Date(currentDate);
                      newDate.setMonth(newDate.getMonth() - 1);
                      setCurrentDate(newDate);
                    }}
                    className="p-3 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <ChevronLeft size={20} />
                  </button>
                  <button
                    onClick={() => setCurrentDate(new Date())}
                    className="px-4 py-2 bg-blue-500 text-white rounded-xl text-sm font-medium hover:bg-blue-600 transition-colors"
                  >
                    ì´ë²ˆ ë‹¬
                  </button>
                  <button
                    onClick={() => {
                      const newDate = new Date(currentDate);
                      newDate.setMonth(newDate.getMonth() + 1);
                      setCurrentDate(newDate);
                    }}
                    className="p-3 hover:bg-gray-100 rounded-xl transition-colors"
                  >
                    <ChevronRight size={20} />
                  </button>
                </div>
              </div>

              {(() => {
                // í˜„ì¬ ì›”ì˜ ë°ì´í„° ê³„ì‚°
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const startDate = new Date(year, month, 1);
                const endDate = new Date(year, month + 1, 0);
                
                const currentMonthData = transactions.filter(t => {
                  const transactionDate = new Date(t.date);
                  return transactionDate >= startDate && transactionDate <= endDate;
                });

                // ì´ì „ ì›” ë°ì´í„° ê³„ì‚°
                const prevYear = month === 0 ? year - 1 : year;
                const prevMonth = month === 0 ? 11 : month - 1;
                const prevStartDate = new Date(prevYear, prevMonth, 1);
                const prevEndDate = new Date(prevYear, prevMonth + 1, 0);
                
                const previousMonthData = transactions.filter(t => {
                  const transactionDate = new Date(t.date);
                  return transactionDate >= prevStartDate && transactionDate <= prevEndDate;
                });

                // ìˆ˜ì…/ì§€ì¶œ ê³„ì‚°
                const currentIncome = currentMonthData
                  .filter(t => t.type === 'income')
                  .reduce((sum, t) => sum + t.amount, 0);
                
                const currentExpense = currentMonthData
                  .filter(t => t.type === 'expense')
                  .reduce((sum, t) => sum + t.amount, 0);

                const previousIncome = previousMonthData
                  .filter(t => t.type === 'income')
                  .reduce((sum, t) => sum + t.amount, 0);
                
                const previousExpense = previousMonthData
                  .filter(t => t.type === 'expense')
                  .reduce((sum, t) => sum + t.amount, 0);

                // ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ê³„ì‚°
                const expensesByCategory = currentMonthData
                  .filter(t => t.type === 'expense')
                  .reduce((acc, t) => {
                    const category = CATEGORIES.expense.find(c => c.id === t.category);
                    const categoryName = category ? category.name : 'ê¸°íƒ€';
                    acc[categoryName] = (acc[categoryName] || 0) + t.amount;
                    return acc;
                  }, {});

                // ë³€í™”ìœ¨ ê³„ì‚°
                const incomeChange = previousIncome > 0 ? ((currentIncome - previousIncome) / previousIncome) * 100 : 0;
                const expenseChange = previousExpense > 0 ? ((currentExpense - previousExpense) / previousExpense) * 100 : 0;
                const savingChange = currentIncome - currentExpense;

                return (
                  <>
                    {/* ìš”ì•½ ì¹´ë“œë“¤ */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600 mb-1">ì´ë²ˆ ë‹¬ ìˆ˜ì…</p>
                            <p className="text-2xl font-bold text-gray-800">{formatCurrency(currentIncome)}ì›</p>
                            {incomeChange !== 0 && (
                              <div className={`flex items-center mt-2 text-sm ${
                                incomeChange >= 0 ? 'text-green-600' : 'text-red-600'
                              }`}>
                                <span>ì „ì›” ëŒ€ë¹„ </span>
                                <span className="font-semibold ml-1">
                                  {incomeChange > 0 ? '+' : ''}{incomeChange.toFixed(1)}%
                                </span>
                              </div>
                            )}
                          </div>
                          <div className="p-4 rounded-full bg-green-100 text-green-600">
                            <TrendingUp size={32} />
                          </div>
                        </div>
                      </div>

                      <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600 mb-1">ì´ë²ˆ ë‹¬ ì§€ì¶œ</p>
                            <p className="text-2xl font-bold text-gray-800">{formatCurrency(currentExpense)}ì›</p>
                            {expenseChange !== 0 && (
                              <div className={`flex items-center mt-2 text-sm ${
                                expenseChange <= 0 ? 'text-green-600' : 'text-red-600'
                              }`}>
                                <span>ì „ì›” ëŒ€ë¹„ </span>
                                <span className="font-semibold ml-1">
                                  {expenseChange > 0 ? '+' : ''}{expenseChange.toFixed(1)}%
                                </span>
                              </div>
                            )}
                          </div>
                          <div className="p-4 rounded-full bg-red-100 text-red-600">
                            <Receipt size={32} />
                          </div>
                        </div>
                      </div>

                      <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600 mb-1">ì´ë²ˆ ë‹¬ ì €ì¶•</p>
                            <p className="text-2xl font-bold text-gray-800">{formatCurrency(savingChange)}ì›</p>
                          </div>
                          <div className={`p-4 rounded-full ${
                            savingChange >= 0 ? 'bg-blue-100 text-blue-600' : 'bg-red-100 text-red-600'
                          }`}>
                            <PiggyBank size={32} />
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ì°¨íŠ¸ */}
                    <div className="bg-white rounded-xl p-6 shadow-lg">
                      <h3 className="text-lg font-bold text-gray-800 mb-6">ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</h3>
                      
                      {Object.keys(expensesByCategory).length > 0 ? (
                        <div className="space-y-4">
                          {Object.entries(expensesByCategory)
                            .sort(([,a], [,b]) => b - a)
                            .map(([category, amount], index) => {
                              const maxAmount = Math.max(...Object.values(expensesByCategory));
                              const percentage = maxAmount > 0 ? (amount / maxAmount) * 100 : 0;
                              const colors = ['bg-blue-500', 'bg-red-500', 'bg-green-500', 'bg-yellow-500', 'bg-purple-500', 'bg-pink-500', 'bg-indigo-500'];
                              
                              return (
                                <div key={category} className="space-y-2">
                                  <div className="flex justify-between text-sm">
                                    <span className="text-gray-700 font-medium">{category}</span>
                                    <span className="font-bold text-gray-800">
                                      {formatCurrency(amount)}ì›
                                    </span>
                                  </div>
                                  <div className="w-full bg-gray-200 rounded-full h-3">
                                    <div 
                                      className={`h-3 rounded-full transition-all duration-1000 ease-out ${colors[index % colors.length]}`}
                                      style={{ width: `${percentage}%` }}
                                    ></div>
                                  </div>
                                </div>
                              );
                            })}
                        </div>
                      ) : (
                        <div className="text-center py-8">
                          <div className="text-6xl mb-4">ğŸ“Š</div>
                          <p className="text-gray-500">ì´ë²ˆ ë‹¬ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</p>
                        </div>
                      )}
                    </div>

                    {/* ê°€ê³„ ë¶„ì„ */}
                    <div className="bg-white rounded-xl p-6 shadow-lg">
                      <h3 className="text-lg font-bold text-gray-800 mb-4">ğŸ’¡ ì´ë²ˆ ë‹¬ ê°€ê³„ ë¶„ì„</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="space-y-4">
                          <h4 className="font-semibold text-gray-700 flex items-center">
                            <TrendingUp size={16} className="mr-2 text-green-600" />
                            ìˆ˜ì… ë¶„ì„
                          </h4>
                          <div className="space-y-3 text-sm bg-green-50 p-4 rounded-lg">
                            <div className="flex justify-between">
                              <span>ì´ ìˆ˜ì…:</span>
                              <span className="font-bold text-green-700">+{formatCurrency(currentIncome)}ì›</span>
                            </div>
                            <div className="flex justify-between">
                              <span>ì „ì›” ëŒ€ë¹„:</span>
                              <span className={incomeChange >= 0 ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}>
                                {incomeChange > 0 ? '+' : ''}{incomeChange.toFixed(1)}%
                              </span>
                            </div>
                          </div>
                        </div>
                        
                        <div className="space-y-4">
                          <h4 className="font-semibold text-gray-700 flex items-center">
                            <Receipt size={16} className="mr-2 text-red-600" />
                            ì§€ì¶œ ë¶„ì„
                          </h4>
                          <div className="space-y-3 text-sm bg-red-50 p-4 rounded-lg">
                            <div className="flex justify-between">
                              <span>ì´ ì§€ì¶œ:</span>
                              <span className="font-bold text-red-700">-{formatCurrency(currentExpense)}ì›</span>
                            </div>
                            <div className="flex justify-between">
                              <span>ì „ì›” ëŒ€ë¹„:</span>
                              <span className={expenseChange <= 0 ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}>
                                {expenseChange > 0 ? '+' : ''}{expenseChange.toFixed(1)}%
                              </span>
                            </div>
                            <div className="flex justify-between">
                              <span>ìˆ˜ì… ëŒ€ë¹„ ì§€ì¶œìœ¨:</span>
                              <span className="font-bold text-gray-800">
                                {currentIncome > 0 ? ((currentExpense / currentIncome) * 100).toFixed(1) : 0}%
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>

                      {savingChange > 0 ? (
                        <div className="mt-6 p-6 bg-gradient-to-r from-green-100 to-blue-100 rounded-xl border border-green-200">
                          <div className="flex items-start space-x-3">
                            <div className="text-3xl">ğŸ‰</div>
                            <div>
                              <p className="font-bold text-green-800 text-lg">í›Œë¥­í•´ìš”!</p>
                              <p className="text-green-700 mt-1">
                                ì´ë²ˆ ë‹¬ <span className="font-bold text-xl">{formatCurrency(savingChange)}ì›</span>ì„ ì €ì¶•í•˜ì…¨ìŠµë‹ˆë‹¤.
                              </p>
                              <p className="text-sm text-green-600 mt-2">
                                ìˆ˜ì…ì˜ {currentIncome > 0 ? ((savingChange / currentIncome) * 100).toFixed(1) : 0}%ë¥¼ ì €ì¶•í•˜ê³  ê³„ì‹œë„¤ìš”! ğŸ‘
                              </p>
                            </div>
                          </div>
                        </div>
                      ) : (
                        <div className="mt-6 p-6 bg-gradient-to-r from-red-100 to-orange-100 rounded-xl border border-red-200">
                          <div className="flex items-start space-x-3">
                            <div className="text-3xl">âš ï¸</div>
                            <div>
                              <p className="font-bold text-red-800 text-lg">ì£¼ì˜ê°€ í•„ìš”í•´ìš”</p>
                              <p className="text-red-700 mt-1">
                                ì´ë²ˆ ë‹¬ ì§€ì¶œì´ ìˆ˜ì…ë³´ë‹¤ <span className="font-bold text-xl">{formatCurrency(Math.abs(savingChange))}ì›</span> ë§ìŠµë‹ˆë‹¤.
                              </p>
                              <p className="text-sm text-red-600 mt-2">
                                ë‹¤ìŒ ë‹¬ì—ëŠ” ì§€ì¶œì„ ì¤„ì—¬ë³´ì‹œëŠ” ê²ƒì´ ì–´ë–¨ê¹Œìš”? ğŸ’ª
                              </p>
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  </>
                );
              })()}
            </div>
          )}

          {currentView === 'fixed' && (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-gray-800">ê³ ì •ì§€ì¶œ ê´€ë¦¬</h2>
                <button
                  onClick={() => {
                    resetFixedForm();
                    setShowAddFixed(true);
                  }}
                  className="flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105"
                >
                  <Plus size={20} />
                  <span>ê³ ì •ì§€ì¶œ ì¶”ê°€</span>
                </button>
              </div>

              {(() => {
                // ê³ ì •ì§€ì¶œ ì´í•© ê³„ì‚°
                const activeFixedTotal = fixedExpenses
                  .filter(fixed => fixed.isActive)
                  .reduce((sum, fixed) => sum + fixed.amount, 0);

                return (
                  <>
                    {/* ìš”ì•½ ì¹´ë“œ */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                      <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600 mb-1">í™œì„± ê³ ì •ì§€ì¶œ</p>
                            <p className="text-2xl font-bold text-gray-800">
                              {fixedExpenses.filter(f => f.isActive).length}ê°œ
                            </p>
                          </div>
                          <div className="p-4 rounded-full bg-blue-100 text-blue-600">
                            <Receipt size={32} />
                          </div>
                        </div>
                      </div>

                      <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600 mb-1">ì›” ì´ ê³ ì •ì§€ì¶œ</p>
                            <p className="text-2xl font-bold text-red-600">
                              {formatCurrency(activeFixedTotal)}ì›
                            </p>
                          </div>
                          <div className="p-4 rounded-full bg-red-100 text-red-600">
                            <TrendingUp size={32} />
                          </div>
                        </div>
                      </div>

                      <div className="bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-shadow">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="text-sm text-gray-600 mb-1">ì „ì²´ í•­ëª©</p>
                            <p className="text-2xl font-bold text-gray-800">
                              {fixedExpenses.length}ê°œ
                            </p>
                            <p className="text-xs text-gray-500 mt-1">
                              ë¹„í™œì„±: {fixedExpenses.filter(f => !f.isActive).length}ê°œ
                            </p>
                          </div>
                          <div className="p-4 rounded-full bg-gray-100 text-gray-600">
                            <Settings size={32} />
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* ê³ ì •ì§€ì¶œ ëª©ë¡ */}
                    <div className="bg-white rounded-2xl shadow-lg overflow-hidden">
                      <div className="p-6 border-b border-gray-200">
                        <h3 className="text-lg font-bold text-gray-800">ê³ ì •ì§€ì¶œ ëª©ë¡</h3>
                        <p className="text-sm text-gray-600 mt-1">ë§¤ì›” ìë™ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì§€ì¶œì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
                      </div>

                      {fixedExpenses.length === 0 ? (
                        <div className="p-12 text-center">
                          <div className="text-6xl mb-4">ğŸ“‹</div>
                          <h3 className="text-lg font-semibold text-gray-800 mb-2">ë“±ë¡ëœ ê³ ì •ì§€ì¶œì´ ì—†ìŠµë‹ˆë‹¤</h3>
                          <p className="text-gray-600 mb-4">ì›”ì„¸, ëŒ€ì¶œ, ë³´í—˜ë£Œ ë“± ë§¤ì›” ë°œìƒí•˜ëŠ” ì§€ì¶œì„ ë“±ë¡í•´ë³´ì„¸ìš”</p>
                          <button
                            onClick={() => {
                              resetFixedForm();
                              setShowAddFixed(true);
                            }}
                            className="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors"
                          >
                            ì²« ê³ ì •ì§€ì¶œ ì¶”ê°€í•˜ê¸°
                          </button>
                        </div>
                      ) : (
                        <div className="divide-y divide-gray-200">
                          {fixedExpenses.map(fixed => {
                            const category = CATEGORIES.expense.find(c => c.id === fixed.category);
                            const CategoryIcon = category?.icon || MoreHorizontal;
                            const paymentMethod = PAYMENT_METHODS.find(p => p.id === fixed.paymentMethod);

                            return (
                              <div key={fixed.id} className="p-6 hover:bg-gray-50 transition-colors">
                                <div className="flex items-center justify-between">
                                  <div className="flex items-center space-x-4 flex-1">
                                    <div className={`p-3 rounded-xl ${category?.color || 'bg-gray-100 text-gray-600'}`}>
                                      <CategoryIcon size={24} />
                                    </div>
                                    
                                    <div className="flex-1">
                                      <div className="flex items-center space-x-3 mb-1">
                                        <h4 className="text-lg font-semibold text-gray-800">{fixed.name}</h4>
                                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                          fixed.isActive 
                                            ? 'bg-green-100 text-green-700' 
                                            : 'bg-gray-100 text-gray-600'
                                        }`}>
                                          {fixed.isActive ? 'í™œì„±' : 'ë¹„í™œì„±'}
                                        </span>
                                      </div>
                                      
                                      <div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600">
                                        <div>
                                          <span className="font-medium text-red-600">
                                            {formatCurrency(fixed.amount)}ì›
                                          </span>
                                          {fixed.monthlyIncrease > 0 && (
                                            <span className="text-orange-600">
                                              (+{formatCurrency(fixed.monthlyIncrease)})
                                            </span>
                                          )}
                                        </div>
                                        <div>ë§¤ì›” {fixed.autoRegisterDate}ì¼</div>
                                        <div>{category?.name || 'ê¸°íƒ€'}</div>
                                        <div>{paymentMethod?.name || '-'}</div>
                                      </div>
                                      
                                      {fixed.memo && (
                                        <p className="text-sm text-gray-500 mt-2">{fixed.memo}</p>
                                      )}
                                    </div>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <button
                                      onClick={() => handleToggleActive(fixed.id)}
                                      className={`p-2 rounded-lg transition-colors ${
                                        fixed.isActive
                                          ? 'text-green-600 hover:bg-green-100'
                                          : 'text-gray-400 hover:bg-gray-100'
                                      }`}
                                      title={fixed.isActive ? 'ë¹„í™œì„±í™”' : 'í™œì„±í™”'}
                                    >
                                      <Eye size={18} />
                                    </button>
                                    
                                    <button
                                      onClick={() => startEditFixed(fixed)}
                                      className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors"
                                      title="ìˆ˜ì •"
                                    >
                                      <Edit2 size={18} />
                                    </button>
                                    
                                    <button
                                      onClick={() => handleDeleteFixedExpense(fixed.id)}
                                      className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors"
                                      title="ì‚­ì œ"
                                    >
                                      <Trash2 size={18} />
                                    </button>
                                  </div>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      )}
                    </div>

                    {/* ë„ì›€ë§ */}
                    <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border border-blue-200">
                      <h3 className="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                        <AlertCircle size={20} className="mr-2 text-blue-600" />
                        ê³ ì •ì§€ì¶œ ê´€ë¦¬ ë„ì›€ë§
                      </h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
                        <div>
                          <h4 className="font-medium mb-2">ğŸ”„ ìë™ ë“±ë¡</h4>
                          <p>ì„¤ì •í•œ ë‚ ì§œì— ë§¤ì›” ìë™ìœ¼ë¡œ ë‹¬ë ¥ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                        </div>
                        <div>
                          <h4 className="font-medium mb-2">ğŸ“ˆ ì›”ë³„ ì¦ê°€</h4>
                          <p>ëŒ€ì¶œ ì´ìì²˜ëŸ¼ ë§¤ì›” ì¦ê°€í•˜ëŠ” ê¸ˆì•¡ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        <div>
                          <h4 className="font-medium mb-2">â¸ï¸ ì¼ì‹œ ì¤‘ì§€</h4>
                          <p>ë¹„í™œì„±í™”í•˜ë©´ ë‹¬ë ¥ì— í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                        </div>
                        <div>
                          <h4 className="font-medium mb-2">ğŸ“Š í†µê³„ ë°˜ì˜</h4>
                          <p>í™œì„±í™”ëœ ê³ ì •ì§€ì¶œë§Œ í†µê³„ì— í¬í•¨ë©ë‹ˆë‹¤.</p>
                        </div>
                      </div>
                    </div>
                  </>
                );
              })()}
            </div>
          )}

          {currentView === 'search' && (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-gray-800">ë‚´ì—­ ê²€ìƒ‰</h2>
                <button
                  onClick={resetSearch}
                  className="flex items-center space-x-2 px-4 py-2 text-gray-600 bg-gray-100 rounded-xl font-medium hover:bg-gray-200 transition-colors"
                >
                  <X size={16} />
                  <span>ì´ˆê¸°í™”</span>
                </button>
              </div>

              {/* ê²€ìƒ‰ ì˜ì—­ */}
              <div className="bg-white rounded-2xl shadow-lg p-6">
                <div className="space-y-4">
                  {/* í…ìŠ¤íŠ¸ ê²€ìƒ‰ */}
                  <div>
                    <label className="block text-sm font-medium mb-2 text-gray-700">í‚¤ì›Œë“œ ê²€ìƒ‰</label>
                    <div className="relative">
                      <input
                        type="text"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        onKeyDown={(e) => {
                          if (e.key === 'Enter') {
                            performSearch();
                          }
                        }}
                        className="w-full p-3 pl-10 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ë©”ëª¨ë‚˜ ì¹´í…Œê³ ë¦¬ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”"
                      />
                      <Search className="absolute left-3 top-3.5 text-gray-400" size={16} />
                    </div>
                  </div>

                  {/* í•„í„° ì˜ì—­ */}
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {/* íƒ€ì… í•„í„° */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">íƒ€ì…</label>
                      <select
                        value={searchFilters.type}
                        onChange={(e) => setSearchFilters({...searchFilters, type: e.target.value})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="all">ì „ì²´</option>
                        <option value="income">ìˆ˜ì…</option>
                        <option value="expense">ì§€ì¶œ</option>
                      </select>
                    </div>

                    {/* ì¹´í…Œê³ ë¦¬ í•„í„° */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ì¹´í…Œê³ ë¦¬</label>
                      <select
                        value={searchFilters.category}
                        onChange={(e) => setSearchFilters({...searchFilters, category: e.target.value})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="all">ì „ì²´</option>
                        {getAllCategories().map(category => (
                          <option key={category.id} value={category.id}>
                            {category.name} ({category.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'})
                          </option>
                        ))}
                      </select>
                    </div>

                    {/* ì‚¬ìš©ì í•„í„° */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ì‚¬ìš©ì</label>
                      <select
                        value={searchFilters.user}
                        onChange={(e) => setSearchFilters({...searchFilters, user: e.target.value})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="all">ì „ì²´</option>
                        {Object.values(MOCK_USERS).map(user => (
                          <option key={user.id} value={user.id}>{user.name}</option>
                        ))}
                      </select>
                    </div>

                    {/* ê²€ìƒ‰ ë²„íŠ¼ */}
                    <div className="flex items-end">
                      <button
                        onClick={performSearch}
                        className="w-full py-2.5 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105"
                      >
                        ê²€ìƒ‰
                      </button>
                    </div>
                  </div>

                  {/* ë‚ ì§œ ë²”ìœ„ */}
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ì‹œì‘ ë‚ ì§œ</label>
                      <input
                        type="date"
                        value={searchFilters.dateFrom}
                        onChange={(e) => setSearchFilters({...searchFilters, dateFrom: e.target.value})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ë ë‚ ì§œ</label>
                      <input
                        type="date"
                        value={searchFilters.dateTo}
                        onChange={(e) => setSearchFilters({...searchFilters, dateTo: e.target.value})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                    </div>
                  </div>

                  {/* ê¸ˆì•¡ ë²”ìœ„ */}
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ìµœì†Œ ê¸ˆì•¡</label>
                      <input
                        type="text"
                        value={searchFilters.amountMin}
                        onChange={(e) => setSearchFilters({...searchFilters, amountMin: e.target.value.replace(/[^0-9]/g, '')})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ì˜ˆ: 10000"
                      />
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ìµœëŒ€ ê¸ˆì•¡</label>
                      <input
                        type="text"
                        value={searchFilters.amountMax}
                        onChange={(e) => setSearchFilters({...searchFilters, amountMax: e.target.value.replace(/[^0-9]/g, '')})}
                        className="w-full p-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ì˜ˆ: 100000"
                      />
                    </div>
                  </div>
                </div>
              </div>

              {/* ê²€ìƒ‰ ê²°ê³¼ */}
              <div className="bg-white rounded-2xl shadow-lg">
                <div className="p-6 border-b border-gray-200">
                  <div className="flex justify-between items-center">
                    <h3 className="text-lg font-bold text-gray-800">ê²€ìƒ‰ ê²°ê³¼</h3>
                    {searchResults.length > 0 && (
                      <span className="text-sm text-gray-600">
                        ì´ {searchResults.length}ê°œ ë‚´ì—­
                      </span>
                    )}
                  </div>
                </div>

                {searchResults.length === 0 ? (
                  <div className="p-12 text-center">
                    {searchQuery || Object.values(searchFilters).some(v => v && v !== 'all') ? (
                      <>
                        <div className="text-6xl mb-4">ğŸ”</div>
                        <h3 className="text-lg font-semibold text-gray-800 mb-2">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p className="text-gray-600">ë‹¤ë¥¸ í‚¤ì›Œë“œë‚˜ í•„í„°ë¡œ ë‹¤ì‹œ ê²€ìƒ‰í•´ë³´ì„¸ìš”</p>
                      </>
                    ) : (
                      <>
                        <div className="text-6xl mb-4">ğŸ”</div>
                        <h3 className="text-lg font-semibold text-gray-800 mb-2">ê²€ìƒ‰ì„ ì‹œì‘í•´ë³´ì„¸ìš”</h3>
                        <p className="text-gray-600">í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í•„í„°ë¥¼ ì„¤ì •í•œ í›„ ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”</p>
                      </>
                    )}
                  </div>
                ) : (
                  <div className="divide-y divide-gray-200">
                    {searchResults.map(transaction => {
                      const category = CATEGORIES[transaction.type]?.find(c => c.id === transaction.category);
                      const CategoryIcon = category?.icon || MoreHorizontal;
                      const user = MOCK_USERS[transaction.userId];
                      const paymentMethod = PAYMENT_METHODS.find(p => p.id === transaction.paymentMethod);

                      return (
                        <div key={transaction.id} className="p-6 hover:bg-gray-50 transition-colors">
                          <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-4 flex-1">
                              <div className={`p-3 rounded-xl ${category?.color || 'bg-gray-100 text-gray-600'}`}>
                                <CategoryIcon size={24} />
                              </div>
                              
                              <div className="flex-1">
                                <div className="flex items-center space-x-3 mb-1">
                                  <h4 className="text-lg font-semibold text-gray-800">
                                    {category?.name || 'ê¸°íƒ€'}
                                  </h4>
                                  {transaction.subcategory && (
                                    <span className="text-sm text-gray-500">
                                      â€¢ {transaction.subcategory}
                                    </span>
                                  )}
                                  <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                    transaction.type === 'income' 
                                      ? 'bg-blue-100 text-blue-700' 
                                      : 'bg-red-100 text-red-700'
                                  }`}>
                                    {transaction.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}
                                  </span>
                                </div>
                                
                                <div className="grid grid-cols-2 md:grid-cols-5 gap-4 text-sm text-gray-600">
                                  <div>
                                    <span className={`font-semibold ${
                                      transaction.type === 'income' ? 'text-blue-600' : 'text-red-600'
                                    }`}>
                                      {transaction.type === 'income' ? '+' : '-'}
                                      {formatCurrency(transaction.amount)}ì›
                                    </span>
                                  </div>
                                  <div>{new Date(transaction.date).toLocaleDateString('ko-KR')}</div>
                                  <div>{user?.name || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                                  <div>{paymentMethod?.name || '-'}</div>
                                  <div className="md:col-span-1 text-gray-500 truncate">
                                    {transaction.memo || '-'}
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div className="flex items-center space-x-2">
                              <button
                                onClick={() => startEditTransaction(transaction)}
                                className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors"
                                title="ìˆ˜ì •"
                              >
                                <Edit2 size={18} />
                              </button>
                              
                              <button
                                onClick={() => handleDeleteTransaction(transaction.id)}
                                className="p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors"
                                title="ì‚­ì œ"
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>

              {/* ê²€ìƒ‰ í†µê³„ (ê²°ê³¼ê°€ ìˆì„ ë•Œë§Œ) */}
              {searchResults.length > 0 && (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4">ê²€ìƒ‰ ê²°ê³¼ í†µê³„</h3>
                  
                  {(() => {
                    const totalIncome = searchResults
                      .filter(t => t.type === 'income')
                      .reduce((sum, t) => sum + t.amount, 0);
                    
                    const totalExpense = searchResults
                      .filter(t => t.type === 'expense')
                      .reduce((sum, t) => sum + t.amount, 0);

                    const incomeCount = searchResults.filter(t => t.type === 'income').length;
                    const expenseCount = searchResults.filter(t => t.type === 'expense').length;

                    return (
                      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div className="text-center p-4 bg-blue-50 rounded-lg">
                          <div className="text-2xl font-bold text-blue-600">
                            {incomeCount}
                          </div>
                          <div className="text-sm text-gray-600">ìˆ˜ì… ê±´ìˆ˜</div>
                          <div className="text-lg font-semibold text-blue-700 mt-1">
                            +{formatCurrency(totalIncome)}ì›
                          </div>
                        </div>
                        
                        <div className="text-center p-4 bg-red-50 rounded-lg">
                          <div className="text-2xl font-bold text-red-600">
                            {expenseCount}
                          </div>
                          <div className="text-sm text-gray-600">ì§€ì¶œ ê±´ìˆ˜</div>
                          <div className="text-lg font-semibold text-red-700 mt-1">
                            -{formatCurrency(totalExpense)}ì›
                          </div>
                        </div>
                        
                        <div className="text-center p-4 bg-gray-50 rounded-lg">
                          <div className="text-2xl font-bold text-gray-800">
                            {searchResults.length}
                          </div>
                          <div className="text-sm text-gray-600">ì´ ê±´ìˆ˜</div>
                          <div className="text-lg font-semibold text-gray-700 mt-1">
                            {formatCurrency(totalIncome + totalExpense)}ì›
                          </div>
                        </div>
                        
                        <div className="text-center p-4 bg-purple-50 rounded-lg">
                          <div className={`text-2xl font-bold ${
                            totalIncome - totalExpense >= 0 ? 'text-green-600' : 'text-red-600'
                          }`}>
                            {totalIncome - totalExpense >= 0 ? '+' : ''}
                            {formatCurrency(totalIncome - totalExpense)}ì›
                          </div>
                          <div className="text-sm text-gray-600">ìˆ˜ì…-ì§€ì¶œ</div>
                        </div>
                      </div>
                    );
                  })()}
                </div>
              )}
            </div>
          )}

          {currentView === 'settings' && (
            <div className="space-y-6">
              <div className="flex justify-between items-center">
                <h2 className="text-2xl font-bold text-gray-800">ì„¤ì •</h2>
                <div className="flex space-x-2">
                  <button
                    onClick={exportData}
                    className="flex items-center space-x-2 px-4 py-2 bg-green-500 text-white rounded-xl font-medium hover:bg-green-600 transition-colors"
                  >
                    <Receipt size={16} />
                    <span>ë‚´ë³´ë‚´ê¸°</span>
                  </button>
                  <button
                    onClick={resetAllData}
                    className="flex items-center space-x-2 px-4 py-2 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-colors"
                  >
                    <AlertCircle size={16} />
                    <span>ì´ˆê¸°í™”</span>
                  </button>
                </div>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* ê¸°ë³¸ ì„¤ì • */}
                <div className="bg-white rounded-2xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <Settings size={20} className="mr-2 text-blue-600" />
                    ê¸°ë³¸ ì„¤ì •
                  </h3>
                  
                  <div className="space-y-4">
                    {/* í…Œë§ˆ ì„¤ì • */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">í…Œë§ˆ</label>
                      <select
                        value={settings.theme}
                        onChange={(e) => updateSettings({theme: e.target.value})}
                        className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="default">ê¸°ë³¸ í…Œë§ˆ</option>
                        <option value="dark">ë‹¤í¬ í…Œë§ˆ</option>
                        <option value="colorful">ì»¬ëŸ¬í’€ í…Œë§ˆ</option>
                      </select>
                    </div>

                    {/* í†µí™” ì„¤ì • */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">í†µí™”</label>
                      <select
                        value={settings.currency}
                        onChange={(e) => updateSettings({currency: e.target.value})}
                        className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="KRW">ì› (â‚©)</option>
                        <option value="USD">ë‹¬ëŸ¬ ($)</option>
                        <option value="EUR">ìœ ë¡œ (â‚¬)</option>
                      </select>
                    </div>

                    {/* ë‚ ì§œ í˜•ì‹ */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ë‚ ì§œ í˜•ì‹</label>
                      <select
                        value={settings.dateFormat}
                        onChange={(e) => updateSettings({dateFormat: e.target.value})}
                        className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="ko-KR">2024ë…„ 12ì›” 25ì¼</option>
                        <option value="en-US">Dec 25, 2024</option>
                      </select>
                    </div>
                  </div>
                </div>

                {/* ì˜ˆì‚° ì„¤ì • */}
                <div className="bg-white rounded-2xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <PiggyBank size={20} className="mr-2 text-green-600" />
                    ì˜ˆì‚° ì„¤ì •
                  </h3>
                  
                  <div className="space-y-4">
                    {/* ì›” ì˜ˆì‚° */}
                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ì›” ì˜ˆì‚°</label>
                      <input
                        type="text"
                        value={settings.budget.monthly ? parseInt(settings.budget.monthly).toLocaleString() : ''}
                        onBlur={(e) => {
                          const value = e.target.value.replace(/[^0-9]/g, '');
                          updateSettings({
                            budget: {...settings.budget, monthly: value}
                          });
                          if (value) {
                            e.target.value = parseInt(value).toLocaleString();
                          }
                        }}
                        onFocus={(e) => {
                          const value = e.target.value.replace(/[^0-9]/g, '');
                          e.target.value = value;
                        }}
                        className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="ì˜ˆ: 2000000"
                      />
                    </div>

                    {/* ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆì‚° */}
                    <div>
                      <label className="block text-sm font-medium mb-3 text-gray-700">ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆì‚°</label>
                      <div className="space-y-3">
                        {Object.entries(settings.budget.categories).map(([categoryId, amount]) => {
                          const category = CATEGORIES.expense.find(c => c.id === categoryId);
                          if (!category) return null;
                          
                          return (
                            <div key={categoryId} className="flex items-center space-x-3">
                              <div className={`p-2 rounded-lg ${category.color}`}>
                                {React.createElement(category.icon, { size: 16 })}
                              </div>
                              <span className="text-sm font-medium text-gray-700 w-20">
                                {category.name}
                              </span>
                              <input
                                type="text"
                                value={amount ? parseInt(amount).toLocaleString() : ''}
                                onBlur={(e) => {
                                  const value = e.target.value.replace(/[^0-9]/g, '');
                                  updateSettings({
                                    budget: {
                                      ...settings.budget,
                                      categories: {
                                        ...settings.budget.categories,
                                        [categoryId]: value
                                      }
                                    }
                                  });
                                  if (value) {
                                    e.target.value = parseInt(value).toLocaleString();
                                  }
                                }}
                                onFocus={(e) => {
                                  const value = e.target.value.replace(/[^0-9]/g, '');
                                  e.target.value = value;
                                }}
                                className="flex-1 p-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                placeholder="ì˜ˆì‚° ì…ë ¥"
                              />
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  </div>
                </div>

                {/* ì•Œë¦¼ ì„¤ì • */}
                <div className="bg-white rounded-2xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <AlertCircle size={20} className="mr-2 text-yellow-600" />
                    ì•Œë¦¼ ì„¤ì •
                  </h3>
                  
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm font-medium text-gray-700">ì˜ˆì‚° ì´ˆê³¼ ì•Œë¦¼</p>
                        <p className="text-xs text-gray-500">ì˜ˆì‚°ì„ ì´ˆê³¼í•  ë•Œ ì•Œë¦¼ì„ ë°›ìŠµë‹ˆë‹¤</p>
                      </div>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input
                          type="checkbox"
                          checked={settings.notifications.budgetAlert}
                          onChange={(e) => updateSettings({
                            notifications: {
                              ...settings.notifications,
                              budgetAlert: e.target.checked
                            }
                          })}
                          className="sr-only peer"
                        />
                        <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>

                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm font-medium text-gray-700">ì¼ì¼ ê¸°ë¡ ì•Œë¦¼</p>
                        <p className="text-xs text-gray-500">ë§¤ì¼ ê°€ê³„ë¶€ ì‘ì„±ì„ ë¦¬ë§ˆì¸ë“œí•©ë‹ˆë‹¤</p>
                      </div>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input
                          type="checkbox"
                          checked={settings.notifications.dailyReminder}
                          onChange={(e) => updateSettings({
                            notifications: {
                              ...settings.notifications,
                              dailyReminder: e.target.checked
                            }
                          })}
                          className="sr-only peer"
                        />
                        <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>

                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm font-medium text-gray-700">ì£¼ê°„ ë¦¬í¬íŠ¸</p>
                        <p className="text-xs text-gray-500">ë§¤ì£¼ ê°€ê³„ë¶€ ìš”ì•½ì„ ë°›ì•„ë´…ë‹ˆë‹¤</p>
                      </div>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input
                          type="checkbox"
                          checked={settings.notifications.weeklyReport}
                          onChange={(e) => updateSettings({
                            notifications: {
                              ...settings.notifications,
                              weeklyReport: e.target.checked
                            }
                          })}
                          className="sr-only peer"
                        />
                        <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>
                  </div>
                </div>

                {/* ë°±ì—… ì„¤ì • */}
                <div className="bg-white rounded-2xl shadow-lg p-6">
                  <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <Receipt size={20} className="mr-2 text-purple-600" />
                    ë°±ì—… ì„¤ì •
                  </h3>
                  
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm font-medium text-gray-700">ìë™ ë°±ì—…</p>
                        <p className="text-xs text-gray-500">ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë°±ì—…í•©ë‹ˆë‹¤</p>
                      </div>
                      <label className="relative inline-flex items-center cursor-pointer">
                        <input
                          type="checkbox"
                          checked={settings.backup.autoBackup}
                          onChange={(e) => updateSettings({
                            backup: {
                              ...settings.backup,
                              autoBackup: e.target.checked
                            }
                          })}
                          className="sr-only peer"
                        />
                        <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                      </label>
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ë°±ì—… ì£¼ê¸°</label>
                      <select
                        value={settings.backup.backupFrequency}
                        onChange={(e) => updateSettings({
                          backup: {
                            ...settings.backup,
                            backupFrequency: e.target.value
                          }
                        })}
                        className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      >
                        <option value="daily">ë§¤ì¼</option>
                        <option value="weekly">ë§¤ì£¼</option>
                        <option value="monthly">ë§¤ì›”</option>
                      </select>
                    </div>

                    <div className="pt-2">
                      <button
                        onClick={exportData}
                        className="w-full py-3 bg-purple-500 text-white rounded-xl font-medium hover:bg-purple-600 transition-colors"
                      >
                        ì§€ê¸ˆ ë°±ì—…í•˜ê¸°
                      </button>
                    </div>

                    <div>
                      <label className="block text-sm font-medium mb-2 text-gray-700">ë°±ì—… ê°€ì ¸ì˜¤ê¸°</label>
                      <input
                        type="file"
                        accept=".json"
                        onChange={(e) => {
                          const file = e.target.files[0];
                          if (file) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                              importData(event.target.result);
                            };
                            reader.readAsText(file);
                          }
                        }}
                        className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                      />
                      <p className="text-xs text-gray-500 mt-1">JSON íŒŒì¼ë§Œ ì§€ì›ë©ë‹ˆë‹¤</p>
                    </div>
                  </div>
                </div>
              </div>

              {/* ì•± ì •ë³´ */}
              <div className="bg-white rounded-2xl shadow-lg p-6">
                <h3 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                  <Heart size={20} className="mr-2 text-red-500" />
                  ì•± ì •ë³´
                </h3>
                
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  <div className="text-center p-4 bg-blue-50 rounded-lg">
                    <div className="text-2xl font-bold text-blue-600">
                      {transactions.length}
                    </div>
                    <div className="text-sm text-gray-600">ì´ ê±°ë˜ ë‚´ì—­</div>
                  </div>
                  
                  <div className="text-center p-4 bg-green-50 rounded-lg">
                    <div className="text-2xl font-bold text-green-600">
                      {fixedExpenses.length}
                    </div>
                    <div className="text-sm text-gray-600">ê³ ì •ì§€ì¶œ í•­ëª©</div>
                  </div>
                  
                  <div className="text-center p-4 bg-purple-50 rounded-lg">
                    <div className="text-2xl font-bold text-purple-600">
                      v1.0
                    </div>
                    <div className="text-sm text-gray-600">ì•± ë²„ì „</div>
                  </div>
                  
                  <div className="text-center p-4 bg-pink-50 rounded-lg">
                    <div className="text-2xl font-bold text-pink-600">
                      ğŸ’•
                    </div>
                    <div className="text-sm text-gray-600">ìš°ì˜â™¥ë‹¬ë¦¼</div>
                  </div>
                </div>

                <div className="mt-6 text-center text-sm text-gray-500">
                  <p>ë¶€ë¶€ë¥¼ ìœ„í•œ ê°€ê³„ë¶€ ì•±</p>
                  <p className="mt-1">ì‚¬ë‘ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ì™„ë²½í•œ ê°€ê³„ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
                </div>
              </div>
            </div>
          )}

          {currentView !== 'calendar' && currentView !== 'statistics' && currentView !== 'fixed' && currentView !== 'search' && currentView !== 'settings' && (
            <div className="p-8 text-center text-gray-500">
              <div className="text-6xl mb-4">ğŸš§</div>
              <h3 className="text-xl font-semibold mb-2">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</h3>
              <p>í•´ë‹¹ ê¸°ëŠ¥ì€ ê³§ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
            </div>
          )}
        </main>
      </div>

      {currentView === 'calendar' && (
        <button
          onClick={() => startAddTransaction()}
          className="fixed bottom-8 right-8 bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-full shadow-2xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-110"
        >
          <Plus size={28} />
        </button>
      )}

      {showAddTransaction && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl">
            <div className="p-6">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-xl font-bold text-gray-800">
                  {isEditMode ? 'ë‚´ì—­ ìˆ˜ì •' : 'ë‚´ì—­ ì¶”ê°€'}
                </h2>
                <button 
                  type="button"
                  onClick={() => {
                    resetForm();
                    setShowAddTransaction(false);
                  }}
                  className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                >
                  <X size={20} />
                </button>
              </div>

              <div className="space-y-4">
                <div className="flex space-x-2">
                  <button
                    type="button"
                    onClick={() => setTransactionForm({...transactionForm, type: 'expense', category: ''})}
                    className={`flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-200 ${
                      transactionForm.type === 'expense'
                        ? 'bg-red-500 text-white shadow-lg'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    ì§€ì¶œ
                  </button>
                  <button
                    type="button"
                    onClick={() => setTransactionForm({...transactionForm, type: 'income', category: ''})}
                    className={`flex-1 py-3 px-4 rounded-xl font-medium transition-all duration-200 ${
                      transactionForm.type === 'income'
                        ? 'bg-blue-500 text-white shadow-lg'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    ìˆ˜ì…
                  </button>
                </div>

                <div>
                  <label className="block text-sm font-medium mb-3 text-gray-700">ì¹´í…Œê³ ë¦¬</label>
                  <div className="grid grid-cols-3 gap-3">
                    {CATEGORIES[transactionForm.type].map(category => {
                      const IconComponent = category.icon;
                      return (
                        <button
                          key={category.id}
                          type="button"
                          onClick={() => setTransactionForm({...transactionForm, category: category.id})}
                          className={`p-3 rounded-xl border-2 transition-all duration-200 transform hover:scale-105 ${
                            transactionForm.category === category.id
                              ? 'border-blue-500 bg-blue-50 shadow-lg' 
                              : 'border-gray-200 hover:border-gray-300 hover:shadow-md'
                          } ${category.color}`}
                        >
                          <div className="flex flex-col items-center space-y-1">
                            <IconComponent size={24} />
                            <span className="text-xs font-medium">{category.name}</span>
                          </div>
                        </button>
                      );
                    })}
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">ê¸ˆì•¡</label>
                  <input
                    type="text"
                    value={transactionForm.amount}
                    onChange={(e) => setTransactionForm({...transactionForm, amount: e.target.value.replace(/[^0-9]/g, '')})}
                    className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder="ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">ë‚ ì§œ</label>
                  <input
                    type="date"
                    value={transactionForm.date}
                    onChange={(e) => setTransactionForm({...transactionForm, date: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">ë©”ëª¨</label>
                  <textarea
                    value={transactionForm.memo}
                    onChange={(e) => setTransactionForm({...transactionForm, memo: e.target.value})}
                    className="w-full p-3 border border-gray-300 rounded-xl resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    rows="3"
                    placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                  />
                </div>

                <div className="flex space-x-3 pt-4">
                  <button
                    type="button"
                    onClick={() => {
                      resetForm();
                      setShowAddTransaction(false);
                    }}
                    className="flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-colors"
                  >
                    ì·¨ì†Œ
                  </button>
                  <button
                    type="button"
                    onClick={handleSubmitTransaction}
                    disabled={!transactionForm.category || !transactionForm.amount}
                    className="flex-1 py-3 px-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-medium disabled:bg-gray-300 hover:from-blue-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 disabled:transform-none"
                  >
                    {isEditMode ? 'ìˆ˜ì •' : 'ì €ì¥'}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {showBackupModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto shadow-2xl">
            <div className="p-6">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-xl font-bold text-gray-800">ë°ì´í„° ë°±ì—…</h2>
                <button 
                  type="button"
                  onClick={() => {
                    setShowBackupModal(false);
                    setBackupData('');
                  }}
                  className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                >
                  <X size={20} />
                </button>
              </div>

              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-2 text-gray-700">
                    ë°±ì—… ë°ì´í„° (JSON)
                  </label>
                  <textarea
                    value={backupData}
                    readOnly
                    className="w-full h-64 p-3 border border-gray-300 rounded-xl bg-gray-50 text-sm font-mono"
                  />
                </div>

                <div className="flex space-x-3">
                  <button
                    type="button"
                    onClick={() => {
                      navigator.clipboard.writeText(backupData);
                      alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    }}
                    className="flex-1 py-3 px-4 border border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-50 transition-colors"
                  >
                    í´ë¦½ë³´ë“œ ë³µì‚¬
                  </button>
                  <button
                    type="button"
                    onClick={downloadBackup}
                    className="flex-1 py-3 px-4 bg-gradient-to-r from-green-500 to-blue-500 text-white rounded-xl font-medium hover:from-green-600 hover:to-blue-600 transition-all duration-200 transform hover:scale-105"
                  >
                    íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                  </button>
                </div>

                <div className="text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
                  <p className="font-medium mb-1">ğŸ’¡ ë°±ì—… ì‚¬ìš©ë²•:</p>
                  <ul className="space-y-1 text-xs">
                    <li>â€¢ í´ë¦½ë³´ë“œ ë³µì‚¬: ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥</li>
                    <li>â€¢ íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ì•ˆì „í•œ ë³´ê´€ìš©</li>
                    <li>â€¢ ë°±ì—… ê°€ì ¸ì˜¤ê¸°: ì„¤ì •ì—ì„œ JSON íŒŒì¼ ì—…ë¡œë“œ</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}